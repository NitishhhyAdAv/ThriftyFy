# Thriftfy Authentication - Visual Diagrams & Flows

## Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APP LAUNCHES                          â”‚
â”‚                   main.dart runs                         â”‚
â”‚          Firebase.initializeApp() called                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WELCOME SCREEN                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Thriftfy - Buy & Sell Aesthetics          â”‚        â”‚
â”‚  â”‚                                              â”‚        â”‚
â”‚  â”‚   Select Your Role:                         â”‚        â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚        â”‚
â”‚  â”‚   â”‚   ğŸ›ï¸ BUYER   â”‚    â”‚ ğŸª SELLER    â”‚      â”‚        â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”œâ”€â”€â”€ [BUYER selected] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â””â”€â”€â”€ [SELLER selected] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                                                             â”‚â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚              LOGIN PAGE (with Role)                    â”‚  â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚â”‚
â”‚  â”‚  Welcome Back, Buyer/Seller!                  â”‚   â”‚  â”‚â”‚
â”‚  â”‚                                                â”‚   â”‚  â”‚â”‚
â”‚  â”‚  Email:     [____________]                    â”‚   â”‚  â”‚â”‚
â”‚  â”‚  Password:  [____________]                    â”‚   â”‚  â”‚â”‚
â”‚  â”‚                                                â”‚   â”‚  â”‚â”‚
â”‚  â”‚  [  LOGIN BUTTON  ]  [Forgot Password?]      â”‚   â”‚  â”‚â”‚
â”‚  â”‚                                                â”‚   â”‚  â”‚â”‚
â”‚  â”‚  â”€â”€â”€ Or continue with â”€â”€â”€                    â”‚   â”‚  â”‚â”‚
â”‚  â”‚                                                â”‚   â”‚  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚  â”‚â”‚
â”‚  â”‚  â”‚ğŸ“§  Gmail    â”‚  â”‚â˜ï¸  Phone    â”‚           â”‚   â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
             â”‚                                              â”‚â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚â”‚
    â”‚        â”‚                          â”‚                  â”‚â”‚
    â–¼        â–¼                          â–¼                  â”‚â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
â”‚ EMAIL  â”‚ â”‚  GMAIL   â”‚    â”‚  PHONE AUTH SCREEN   â”‚       â”‚â”‚
â”‚ LOGIN  â”‚ â”‚ SIGNIN   â”‚    â”‚                      â”‚       â”‚â”‚
â”‚        â”‚ â”‚          â”‚    â”‚  Enter phone:        â”‚       â”‚â”‚
â”‚(MOCK)  â”‚ â”‚(FIREBASE)â”‚    â”‚  [+1(555)123-4567] â”‚       â”‚â”‚
â”‚        â”‚ â”‚          â”‚    â”‚                      â”‚       â”‚â”‚
â”‚        â”‚ â”‚  User    â”‚    â”‚  [SEND OTP]         â”‚       â”‚â”‚
â”‚        â”‚ â”‚ Profile  â”‚    â”‚                      â”‚       â”‚â”‚
â”‚        â”‚ â”‚ Created  â”‚    â”‚  (OTP received)      â”‚       â”‚â”‚
â”‚        â”‚ â”‚  âœ…      â”‚    â”‚                      â”‚       â”‚â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚  Enter OTP:          â”‚       â”‚â”‚
     â”‚          â”‚          â”‚  [123456]           â”‚       â”‚â”‚
     â”‚          â”‚          â”‚                      â”‚       â”‚â”‚
     â”‚          â”‚          â”‚  [VERIFY OTP]       â”‚       â”‚â”‚
     â”‚          â”‚          â”‚                      â”‚       â”‚â”‚
     â”‚          â”‚          â”‚  âœ… Verified        â”‚       â”‚â”‚
     â”‚          â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
     â”‚          â”‚                   â”‚                     â”‚â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚â”‚
                â”‚                                          â”‚â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚â”‚
     â”‚   Create/Update User in MockService         â”‚      â”‚â”‚
     â”‚   â€¢ Email from auth provider                â”‚      â”‚â”‚
     â”‚   â€¢ Name from auth profile                 â”‚      â”‚â”‚
     â”‚   â€¢ Role (passed from WelcomeScreen)       â”‚      â”‚â”‚
     â”‚   â€¢ Initial balance: 1000.0                â”‚      â”‚â”‚
     â”‚   â€¢ Set as currentUser                     â”‚      â”‚â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚â”‚
                â”‚                                          â”‚â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚â”‚
     â”‚        DASHBOARD (MainLayout)               â”‚      â”‚â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚â”‚
     â”‚  â”‚      Navigation Tabs (4 tabs)        â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ BUYER MODE                     â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Storefront / Market           â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Search                        â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Shopping Cart                 â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Profile âœ¨ (ACTIVE TAB)      â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚                                        â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ SELLER MODE                    â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Dashboard                    â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Market View                  â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Add Listing                  â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â”‚ â€¢ Profile âœ¨ (ACTIVE TAB)     â”‚  â”‚  â”‚      â”‚â”‚
     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚      â”‚â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚â”‚
     â”‚                                             â”‚      â”‚â”‚
     â”‚  PROFILE TAB CONTENT:                      â”‚      â”‚â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚â”‚
     â”‚  â”‚                                    â”‚   â”‚      â”‚â”‚
     â”‚  â”‚  ğŸ‘¤ Avatar (Initials)              â”‚   â”‚      â”‚â”‚
     â”‚  â”‚  Name: John Doe                    â”‚   â”‚      â”‚â”‚
     â”‚  â”‚  Email: john@example.com           â”‚   â”‚      â”‚â”‚
     â”‚  â”‚  Role: BUYER / SELLER              â”‚   â”‚      â”‚â”‚
     â”‚  â”‚                                    â”‚   â”‚      â”‚â”‚
     â”‚  â”‚  [ğŸšª LOGOUT BUTTON]               â”‚   â”‚      â”‚â”‚
     â”‚  â”‚                                    â”‚   â”‚      â”‚â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚â”‚
                   â”‚                                    â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚â”‚
        â”‚  LOGOUT BUTTON TAPPED   â”‚                    â”‚â”‚
        â”‚  logoutAsync() called   â”‚                    â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚â”‚
                   â”‚                                    â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
        â”‚  AuthService.signOut()                 â”‚    â”‚â”‚
        â”‚  â”œâ”€ FirebaseAuth.signOut()            â”‚    â”‚â”‚
        â”‚  â””â”€ GoogleSignIn.signOut()            â”‚    â”‚â”‚
        â”‚     (if used)                          â”‚    â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
                   â”‚                                    â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
        â”‚  MockService cleanup                   â”‚    â”‚â”‚
        â”‚  â”œâ”€ _currentUser = null               â”‚    â”‚â”‚
        â”‚  â””â”€ notifyListeners()                  â”‚    â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
                   â”‚                                    â”‚â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
     â”‚  Navigate back to Welcome Screen          â”‚   â”‚â”‚
     â”‚  pushNamedAndRemoveUntil('/', ...)        â”‚   â”‚â”‚
     â”‚                                            â”‚   â”‚â”‚
     â”‚  All credentials cleared                  â”‚   â”‚â”‚
     â”‚  Session ended                            â”‚   â”‚â”‚
     â”‚  Ready for next login                     â”‚   â”‚â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
                   â”‚                                   â”‚â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜â”‚
                                                    â””â”€â”€â”˜
                   START OVER (New User/Role)
```

---

## Authentication Method Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     METHOD     â”‚    GMAIL     â”‚    PHONE     â”‚EMAIL/PASS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Provider       â”‚ Google       â”‚ Firebase     â”‚ Firebase    â”‚
â”‚ Storage        â”‚ Google Acct  â”‚ Firebase DB  â”‚ Firebase DB â”‚
â”‚ Steps Required â”‚ 1 (Sign-in)  â”‚ 2 (OTP)      â”‚ 1 (Enter)   â”‚
â”‚ Security       â”‚ OAuth Token  â”‚ OTP + Phone  â”‚ Password    â”‚
â”‚ User Creation  â”‚ Automatic    â”‚ Automatic    â”‚ Automatic   â”‚
â”‚ Setup Effort   â”‚ Medium       â”‚ High         â”‚ Low         â”‚
â”‚ User Experienceâ”‚ Seamless     â”‚ Secure       â”‚ Traditional â”‚
â”‚ Best For       â”‚ Quick Login  â”‚ Verification â”‚ Fallback    â”‚
â”‚ Ideal Users    â”‚ Tech Savvy   â”‚ Mobile-first â”‚ All Users   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Firebase Integration Points

```
APP
â”‚
â”œâ”€ main.dart
â”‚  â””â”€ Firebase.initializeApp()
â”‚     âœ… Initializes Firebase Core
â”‚     âœ… Loads google-services.json / GoogleService-Info.plist
â”‚     âœ… Connects to Firebase project
â”‚
â”œâ”€ AuthService (lib/services/auth_service.dart)
â”‚  â”‚
â”‚  â”œâ”€ GoogleSignIn Package
â”‚  â”‚  â””â”€ Google Sign-In API
â”‚  â”‚     âœ… User authentication
â”‚  â”‚     âœ… Access token retrieval
â”‚  â”‚
â”‚  â”œâ”€ FirebaseAuth Package
â”‚  â”‚  â”œâ”€ Google Auth Provider
â”‚  â”‚  â”‚  â””â”€ GoogleAuthProvider.credential()
â”‚  â”‚  â”‚     âœ… Create Firebase credential
â”‚  â”‚  â”‚     âœ… Sign user in
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Phone Auth Provider
â”‚  â”‚  â”‚  â”œâ”€ verifyPhoneNumber()
â”‚  â”‚  â”‚  â”‚  âœ… Request OTP
â”‚  â”‚  â”‚  â”‚  âœ… Handle SMS sending
â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ PhoneAuthProvider.credential()
â”‚  â”‚  â”‚     âœ… Verify OTP
â”‚  â”‚  â”‚     âœ… Sign user in
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ Email Auth Provider
â”‚  â”‚     â”œâ”€ createUserWithEmailAndPassword()
â”‚  â”‚     â”‚  âœ… Create new account
â”‚  â”‚     â”‚
â”‚  â”‚     â””â”€ signInWithEmailAndPassword()
â”‚  â”‚        âœ… Sign in with email
â”‚  â”‚
â”‚  â””â”€ authStateChanges()
â”‚     âœ… Listen to auth changes
â”‚     âœ… Sync user state
â”‚
â””â”€ MockService (lib/data/mock_service.dart)
   â””â”€ Local User Management
      â”œâ”€ loginWithAuth()
      â”‚  âœ… Create user profile
      â”‚  âœ… Store user data locally
      â”‚
      â”œâ”€ logoutAsync()
      â”‚  âœ… Call AuthService.signOut()
      â”‚  âœ… Clear local state
      â”‚
      â””â”€ currentUser
         âœ… Access current user
         âœ… Populate UI with user data
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Firebase Authentication        â”‚
â”‚  (Server-side auth state)          â”‚
â”‚                                    â”‚
â”‚  FirebaseAuth.instance             â”‚
â”‚  â”œâ”€ currentUser (Firebase User)   â”‚
â”‚  â”œâ”€ authStateChanges (Stream)     â”‚
â”‚  â””â”€ signOut()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  AuthService   â”‚
         â”‚  (Wrapper)     â”‚
         â”‚                â”‚
         â”‚  Provides:     â”‚
         â”‚  â€¢ signOut()   â”‚
         â”‚  â€¢ isAuth()    â”‚
         â”‚  â€¢ stream      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  MockService     â”‚
         â”‚  (ChangeNotifier)â”‚
         â”‚                  â”‚
         â”‚  Manages:        â”‚
         â”‚  â€¢ _currentUser  â”‚
         â”‚  â€¢ notifyListen()â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  UI Widgets          â”‚
         â”‚  (Screens)           â”‚
         â”‚                      â”‚
         â”‚  Displays:           â”‚
         â”‚  â€¢ User profile      â”‚
         â”‚  â€¢ Logout button     â”‚
         â”‚  â€¢ Role-based nav    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
USER ACTION
    â”‚
    â”œâ”€ Tap Gmail
    â”‚  â”‚
    â”‚  â””â”€ AuthService.signInWithGoogle()
    â”‚     â”œâ”€ Success
    â”‚     â”‚  â””â”€ Create user & navigate
    â”‚     â””â”€ Error
    â”‚        â”œâ”€ Network error?
    â”‚        â”‚  â””â”€ Show: "Check internet connection"
    â”‚        â”œâ”€ Cancelled?
    â”‚        â”‚  â””â”€ Show: "Sign-in cancelled"
    â”‚        â””â”€ Auth error?
    â”‚           â””â”€ Show: "Google Sign-In failed"
    â”‚
    â”œâ”€ Tap Phone â†’ Enter number
    â”‚  â”‚
    â”‚  â””â”€ AuthService.signInWithPhoneNumber()
    â”‚     â”œâ”€ Valid number?
    â”‚     â”‚  â”œâ”€ YES
    â”‚     â”‚  â”‚  â””â”€ Send OTP
    â”‚     â”‚  â”‚     â”œâ”€ Success
    â”‚     â”‚  â”‚     â”‚  â””â”€ Show OTP input
    â”‚     â”‚  â”‚     â””â”€ Error
    â”‚     â”‚  â”‚        â””â”€ Show: "Failed to send OTP"
    â”‚     â”‚  â””â”€ NO
    â”‚     â”‚     â””â”€ Show: "Invalid phone number"
    â”‚     â”‚
    â”‚     â””â”€ Verification Failed
    â”‚        â””â”€ Show: "Verification error"
    â”‚
    â”œâ”€ OTP entered
    â”‚  â”‚
    â”‚  â””â”€ AuthService.verifyPhoneOTP()
    â”‚     â”œâ”€ Valid OTP?
    â”‚     â”‚  â”œâ”€ YES
    â”‚     â”‚  â”‚  â””â”€ Sign in & navigate
    â”‚     â”‚  â””â”€ NO
    â”‚     â”‚     â””â”€ Show: "Invalid OTP code"
    â”‚     â”‚
    â”‚     â””â”€ Verification error?
    â”‚        â””â”€ Show: "Verification failed"
    â”‚
    â””â”€ Logout
       â”‚
       â””â”€ MockService.logoutAsync()
          â”œâ”€ AuthService.signOut()
          â”‚  â”œâ”€ Firebase sign-out
          â”‚  â”œâ”€ Google sign-out
          â”‚  â””â”€ Errors logged (not shown to user)
          â””â”€ Clear local state
             â””â”€ Navigate to Welcome
```

---

## Database Schema (for reference, if using Firestore)

```
firebase
â”‚
â”œâ”€ users/{uid}
â”‚  â”œâ”€ email: string
â”‚  â”œâ”€ name: string
â”‚  â”œâ”€ role: 'buyer' | 'seller'
â”‚  â”œâ”€ balance: number
â”‚  â”œâ”€ profileImage: string (URL)
â”‚  â”œâ”€ phoneNumber: string (optional)
â”‚  â”œâ”€ createdAt: timestamp
â”‚  â””â”€ updatedAt: timestamp
â”‚
â”œâ”€ products/{productId}
â”‚  â”œâ”€ sellerId: string (ref to users/{uid})
â”‚  â”œâ”€ title: string
â”‚  â”œâ”€ description: string
â”‚  â”œâ”€ price: number
â”‚  â”œâ”€ imageUrl: string
â”‚  â”œâ”€ category: string
â”‚  â”œâ”€ condition: string
â”‚  â”œâ”€ postedAt: timestamp
â”‚  â””â”€ isLabor: boolean
â”‚
â””â”€ orders/{orderId}
   â”œâ”€ buyerId: string (ref to users/{uid})
   â”œâ”€ sellerId: string (ref to users/{uid})
   â”œâ”€ productId: string (ref to products/{productId})
   â”œâ”€ quantity: number
   â”œâ”€ totalAmount: number
   â”œâ”€ status: string
   â”œâ”€ createdAt: timestamp
   â””â”€ completedAt: timestamp (optional)
```

---

## Security Architecture

```
USER INPUT
    â”‚
    â”œâ”€ Validation (Client-side)
    â”‚  â”œâ”€ Email format check
    â”‚  â”œâ”€ Phone number check
    â”‚  â”œâ”€ OTP format check
    â”‚  â””â”€ Empty field check
    â”‚
    â””â”€ If Valid
       â”‚
       â””â”€ Send to Firebase
          â”‚
          â”œâ”€ Firebase Validation
          â”‚  â”œâ”€ Email already exists?
          â”‚  â”œâ”€ Phone number valid?
          â”‚  â”œâ”€ OTP correct?
          â”‚  â””â”€ Rate limiting check
          â”‚
          â””â”€ If Valid
             â”‚
             â””â”€ Authentication
                â”œâ”€ Create session token
                â”œâ”€ Store securely
                â””â”€ Return to app
                   â”‚
                   â””â”€ Local Storage
                      â”œâ”€ Session active
                      â”œâ”€ User cached
                      â””â”€ Role stored
```

---

## Module Dependency Diagram

```
main.dart
    â”‚
    â”œâ”€ Firebase Core
    â”‚  â”œâ”€ Initialize app
    â”‚  â””â”€ Load credentials
    â”‚
    â”œâ”€ Welcome Screen
    â”‚  â”œâ”€ Select role (Buyer/Seller)
    â”‚  â””â”€ Navigate to LoginPage
    â”‚
    â”œâ”€ Login Page
    â”‚  â”œâ”€ Depends: AuthService
    â”‚  â”œâ”€ Depends: MockService
    â”‚  â”œâ”€ Email/Password auth
    â”‚  â”œâ”€ Gmail button
    â”‚  â””â”€ Phone button
    â”‚
    â”œâ”€ Phone Auth Screen
    â”‚  â””â”€ Depends: AuthService
    â”‚     â”œâ”€ Phone verification
    â”‚     â””â”€ OTP verification
    â”‚
    â”œâ”€ Main Layout
    â”‚  â”œâ”€ Depends: MockService
    â”‚  â”œâ”€ Profile display
    â”‚  â””â”€ Logout
    â”‚
    â”œâ”€ AuthService
    â”‚  â”œâ”€ Depends: firebase_auth
    â”‚  â”œâ”€ Depends: google_sign_in
    â”‚  â””â”€ Core auth logic
    â”‚
    â””â”€ MockService
       â””â”€ Depends: AuthService
          â”œâ”€ User state
          â””â”€ Logout integration
```

---

**Visual diagrams show the complete flow and architecture of the authentication system!**
